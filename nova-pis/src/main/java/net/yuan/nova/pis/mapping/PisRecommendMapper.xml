<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="net.yuan.nova.pis.dao.PisRecommendMapper" >
  <resultMap id="BaseResultMap" type="net.yuan.nova.pis.entity.PisRecommend">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 23 14:22:23 CST 2016.
    -->
    <id column="RECOMMEND_ID" property="recommendId" jdbcType="VARCHAR" />
    <result column="CUSTOMER_NAME" property="customerName" jdbcType="VARCHAR" />
    <result column="CUSTOMER_TEL" property="customerTel" jdbcType="VARCHAR" />
    <result column="CITY_ID" property="cityId" jdbcType="VARCHAR" />
    <result column="BUILDING_ID" property="buildingId" jdbcType="VARCHAR" />
    <result column="APPOINTMENT_LOOK_HOUSE_DATE" property="appointmentLookHouseDate" jdbcType="VARCHAR" />
    <result column="REFREE_ID" property="refreeId" jdbcType="VARCHAR" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="RECOMMEND_DATE" property="recommendDate" jdbcType="VARCHAR" />
    <result column="CUSTOMER_PRESENT_DATE" property="customerPresentDate" jdbcType="VARCHAR" />
    <result column="CUSTOMER_PRESENT_USER_ID" property="customerPresentUserId" jdbcType="VARCHAR" />
    <result column="RECOMMEND_CONFIRM_DATE" property="recommendConfirmDate" jdbcType="VARCHAR" />
    <result column="RECOMMEND_CONFIRM_USERID" property="recommendConfirmUserId" jdbcType="VARCHAR" />
    <result column="recommend_Confirm_Advice" property="recommendConfirmAdvice" jdbcType="VARCHAR" />
    
  </resultMap>
  <sql id="Base_Column_List" >
   RECOMMEND_ID,
   CUSTOMER_NAME,
   CUSTOMER_TEL ,
   CITY_ID,
   BUILDING_ID,
   APPOINTMENT_LOOK_HOUSE_DATE,
   REFREE_ID,
   REMARK ,
   STATUS ,
   RECOMMEND_DATE,
   CUSTOMER_PRESENT_DATE ,
   CUSTOMER_PRESENT_USER_ID ,
   RECOMMEND_CONFIRM_DATE,
   RECOMMEND_CONFIRM_USERID,  
   recommend_Confirm_Advice  
  </sql>
  
  <insert id="insert" parameterType="net.yuan.nova.pis.entity.PisRecommend" >
    insert into PIS_RECOMMEND 
    (
    <include refid="Base_Column_List" />
      )
    values (
		#{recommendId,jdbcType=VARCHAR},
		#{customerName,jdbcType=VARCHAR},
		#{customerTel,jdbcType=VARCHAR},
		#{cityId,jdbcType=VARCHAR},
		#{buildingId,jdbcType=VARCHAR},
		#{appointmentLookHouseDate,jdbcType=VARCHAR},
		#{refreeId,jdbcType=VARCHAR},
		#{remark,jdbcType=VARCHAR},
		#{status,jdbcType=VARCHAR},
		#{recommendDate,jdbcType=VARCHAR},
		#{customerPresentDate,jdbcType=VARCHAR},
		#{customerPresentUserId,jdbcType=VARCHAR},
		#{recommendConfirmDate,jdbcType=VARCHAR},
		#{recommendConfirmUserId,jdbcType=VARCHAR},
		#{recommendConfirmAdvice,jdbcType=VARCHAR}
	)
  </insert>
  <select id="getById"  resultMap="BaseResultMap" parameterType="java.lang.String" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND
    where RECOMMEND_ID = #{recommendId,jdbcType=VARCHAR} 
  </select>
  <select id="getWaitingPresent"  resultMap="BaseResultMap" parameterType="net.yuan.nova.pis.entity.PisRecommend" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND
    where STATUS = #{status, jdbcType=VARCHAR}
    and REFREE_ID = #{refreeId,jdbcType=VARCHAR}
    
    <if test="buildingId != null" >
       and BUILDING_ID = #{buildingId,jdbcType=VARCHAR}
    </if>
  </select>
  <select id="getWaitingPresentByKey"  resultMap="BaseResultMap" parameterType="net.yuan.nova.pis.entity.PisRecommend" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND
    where STATUS = #{status, jdbcType=VARCHAR}
    and REFREE_ID = #{refreeId,jdbcType=VARCHAR}
    
    <if test="buildingId != null" >
       AND BUILDING_ID = #{buildingId,jdbcType=VARCHAR}
    </if>
    <if test="customerTel !=null">
    		AND   CUSTOMER_TEL like '%${customerTel}%' 
    </if>
  </select>
  <update id="customerPresent" parameterType="net.yuan.nova.pis.entity.PisRecommend">
      update PIS_RECOMMEND 
      set CUSTOMER_PRESENT_USER_ID=#{customerPresentUserId,jdbcType=VARCHAR},
      CUSTOMER_PRESENT_DATE=#{customerPresentDate,jdbcType=VARCHAR},
      status = #{status,jdbcType=VARCHAR}
      where RECOMMEND_ID = #{recommendId,jdbcType=VARCHAR}
      
  </update>
  <select id="getMyPresent"  resultMap="BaseResultMap" parameterType="java.lang.String" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND
    where CUSTOMER_PRESENT_USER_ID = #{presentUserId, jdbcType=VARCHAR}
  </select>
   <select id="getWaitingConfirm"  resultMap="BaseResultMap" parameterType="java.lang.String" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND
    where BUILDING_ID = #{buildingId,jdbcType=VARCHAR}
    and (STATUS = 'present' or STATUS = 'pledges' or STATUS = 'order') 
  </select>
  <select id="getWaitingConfirmByKey"  resultMap="BaseResultMap" parameterType="net.yuan.nova.pis.entity.PisRecommend" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND
    where BUILDING_ID = #{buildingId,jdbcType=VARCHAR} 
    <if test="customerTel !=null and customerTel !='' ">
    		AND CUSTOMER_TEL like '%${customerTel}%' 
    </if>
    AND (STATUS = 'present' or STATUS = 'pledges' or STATUS = 'order')
  </select>
  <select id="getWaitingComeKey"  resultMap="BaseResultMap" parameterType="java.lang.String" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND
    where BUILDING_ID = #{buildingId,jdbcType=VARCHAR}
    AND (STATUS='appointment')
    <if test="customerTel !=null and customerTel !='' ">
    		AND CUSTOMER_TEL like '%${customerTel}%' 
    </if>
  </select>
  <select id="getWaitingCome"  resultMap="BaseResultMap" parameterType="java.lang.String" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND
    where BUILDING_ID = #{buildingId,jdbcType=VARCHAR}
    AND (STATUS='appointment')
  </select>
  <update id="recommendConfirm" parameterType="net.yuan.nova.pis.entity.PisRecommend">
      update PIS_RECOMMEND 
      set RECOMMEND_CONFIRM_USERID=#{recommendConfirmUserId,jdbcType=VARCHAR},
      RECOMMEND_CONFIRM_DATE=#{recommendConfirmDate,jdbcType=VARCHAR},
      recommend_Confirm_Advice=#{recommendConfirmAdvice,jdbcType=VARCHAR},
      STATUS = #{status,jdbcType=VARCHAR}
      where RECOMMEND_ID = #{recommendId,jdbcType=VARCHAR}
      
  </update>
   <select id="getMyConfirm"  resultMap="BaseResultMap" parameterType="java.lang.String" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND
    where RECOMMEND_CONFIRM_USERID = #{confirmUserId, jdbcType=VARCHAR}
  </select>
  <select id="getAll"  resultMap="BaseResultMap" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND
  </select>
  <select id="getByBrokingFirmId"  resultMap="BaseResultMap"  parameterType="java.lang.String" >
      select 
      a.RECOMMEND_ID,
   a.CUSTOMER_NAME,
   a.CUSTOMER_TEL ,
   a.CITY_ID,
   a.BUILDING_ID,
   a.APPOINTMENT_LOOK_HOUSE_DATE,
   a.REFREE_ID,
   a.REMARK ,
   a.STATUS ,
   a.RECOMMEND_DATE,
   a.CUSTOMER_PRESENT_DATE ,
   a.CUSTOMER_PRESENT_USER_ID ,
   a.RECOMMEND_CONFIRM_DATE,
   a.RECOMMEND_CONFIRM_USERID,  
   a.recommend_Confirm_Advice  
    from PIS_RECOMMEND a,pis_user_extend b where a.refree_Id=b.user_id and b.brokingFirm_Id = #{brokingFirmId}
  </select>
  <select id="getBySaleman"  resultMap="BaseResultMap"  parameterType="java.lang.String" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND WHERE REFREE_ID=#{userId}
  </select>
  <select id="getByBuildingId"  resultMap="BaseResultMap"  parameterType="java.lang.String" >
      select 
      <include refid="Base_Column_List" />
    from PIS_RECOMMEND where BUILDING_ID=#{buildingId}
  </select>
  <select id="getCustomerByTodayAndTel"  resultType="java.lang.Integer" parameterType="java.lang.String" >
  	SELECT COUNT(1) NUM FROM PIS_RECOMMEND T WHERE TO_CHAR(T.RECOMMEND_DATE,'YYYYMMDD')=TO_CHAR(SYSDATE,'YYYYMMDD')  AND T.CUSTOMER_TEL=#{customerTel,jdbcType=VARCHAR} AND T.RECOMMEND_ID=#{refreeId,jdbcType=VARCHAR}
  </select> 
  <select id="getMyPresentByStatusKey"  resultMap="BaseResultMap" parameterType="net.yuan.nova.pis.entity.PisRecommend" >
      SELECT 
      <include refid="Base_Column_List" />
    FROM PIS_RECOMMEND
    WHERE REFREE_ID = #{refreeId, jdbcType=VARCHAR} 
     AND STATUS in ('present','pledges','order')
    <if test="customerTel !=null">
    		AND   CUSTOMER_TEL like '%${customerTel}%' 
    </if>
  </select>
  <select id="getMyPresentByStatus"  resultMap="BaseResultMap" parameterType="java.lang.String" >
      SELECT 
      <include refid="Base_Column_List" />
    FROM PIS_RECOMMEND
    WHERE REFREE_ID = #{presentUserId, jdbcType=VARCHAR} 
    <if test="status!=''">
     	AND STATUS in (${status})
    </if>
  </select>
     <select id="getMyWaitingComeByStatusKey"  resultMap="BaseResultMap" parameterType="net.yuan.nova.pis.entity.PisRecommend" >
      SELECT 
      <include refid="Base_Column_List" />
    FROM PIS_RECOMMEND
    WHERE CUSTOMER_PRESENT_USER_ID = #{customerPresentUserId, jdbcType=VARCHAR}
    AND STATUS in ('present','pledges','order')
    <if test="customerTel !=null">
    		AND   CUSTOMER_TEL like '%${customerTel}%' 
    </if>
  </select>
   <select id="getMyWaitingComeByStatus"  resultMap="BaseResultMap" parameterType="java.lang.String" >
      SELECT 
      <include refid="Base_Column_List" />
    FROM PIS_RECOMMEND
    WHERE CUSTOMER_PRESENT_USER_ID = #{confirmUserId, jdbcType=VARCHAR}
    <if test="status!=''">
    	AND STATUS IN(${status})
    </if>
  </select>
  <select id="getMyConfirmByStatusKey"  resultMap="BaseResultMap" parameterType="net.yuan.nova.pis.entity.PisRecommend" >
      SELECT 
      <include refid="Base_Column_List" />
    FROM PIS_RECOMMEND
    WHERE RECOMMEND_CONFIRM_USERID = #{customerPresentUserId, jdbcType=VARCHAR}
    AND STATUS in ('present','pledges','order')
     <if test="customerTel !=null">
    		AND   CUSTOMER_TEL like '%${customerTel}%' 
    </if>
  </select>
   <select id="getMyConfirmByStatus"  resultMap="BaseResultMap" parameterType="java.lang.String" >
      SELECT 
      <include refid="Base_Column_List" />
    FROM PIS_RECOMMEND
    WHERE RECOMMEND_CONFIRM_USERID = #{confirmUserId, jdbcType=VARCHAR}
    <if test="status!=''">
    	AND STATUS IN(${status})
    </if>
  </select>
  <select id="getRecommendByStatus" resultMap="BaseResultMap" parameterType="java.lang.String">
  		SELECT 
      	<include refid="Base_Column_List" />
    	FROM PIS_RECOMMEND WHERE STATUS=#{status, jdbcType=VARCHAR}
  </select>
  <update id="updateRecommendStatusByRecommendId" parameterType="net.yuan.nova.pis.entity.PisRecommend">
  	UPDATE PIS_RECOMMEND A  SET A.STATUS='X' WHERE A.RECOMMEND_ID=#{recommendId,jdbcType=VARCHAR}
  </update>
</mapper>